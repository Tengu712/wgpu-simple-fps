# Architecture

## Pipelines

本ゲームでは3個のシェーダを用いており、それぞれに1個ずつパイプラインを作成している。

- `skybox.wgsl`: スカイボックス用
  - 透視投影
  - カメラの位置は必ず`(0, 0, 0)`であるべき
  - 深度テストあり
  - イメージテクスチャ・サンプラ
  - パイプライン開始時にレンダーターゲットテクスチャをクリアする
- `ui.wgsl`: UI用
  - 平行投影
  - ビュー変換行列なし
  - イメージテクスチャ・サンプラ
  - パイプライン開始時にレンダーターゲットテクスチャをクリアするか確かめる
- `world.wgsl`: 物体用
  - 透視投影
  - 深度テストあり
  - 平行光源シェーディング

## Draw Requests

描画は描画リクエストを介して行っている。
描画リクエストは`RenderRequest`で表される。
次のフローで処理される。

1. 各種シーン: 描画リクエスト作成
2. `Renderer`: コマンドバッファ記録開始、リクエスト処理
3. 各種パイプライン: リクエストに従って描画コマンド発行
4. `Renderer`: コマンドバッファ提出、プレゼント

## Resize

本ゲームは画面の解像度を指定しない。
これは、MacBookの解像度及びそのアスペクト比が一般的なものではないためである。
本ゲームはフルスクリーンウィンドウに描画される。
そのため、極端な解像度のモニタを使わない限りはUIデザインが崩れることはないだろう。
しかし、逆に言えば、極端な解像度のモニタを使った場合、想定しないUIデザインとなる。

本ゲームは理論上リサイズに対応している。
これは、フルスクリーンウィンドウを作成した後短い間に、ウィンドウの解像度が何度か変わることがあるためである。
リサイズは次のフローで処理される。

1. `Application`: リサイズイベントを受信
2. `Renderer`: サーフェスのリサイズ
3. 各種パイプライン: デプステクスチャやカメラのリサイズ
4. 各種シーン: カメラやUI用のパラメータのリサイズ

## Input

ウィンドウイベントから入力情報を取得している。
入力情報は`InputManager`が管理している。
`InputManager`は押下系の入力を`u32`で、マウスカーソル移動を`f32`で保持する。
それぞれ、次のような特徴がある。

- 押下系: 押下されているフレーム数を表す
- カーソル移動: カーソルが移動したピクセル数
